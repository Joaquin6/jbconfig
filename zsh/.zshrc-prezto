export ZSH=$HOME/.oh-my-zsh
export ZDOTDIR=$JB_ZSH_BASE/zsh/plugins/prezto

handle-add-path $ZDOTDIR

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# set PATH so it includes user's private bin if it exists
if [ -d "$HOME/bin" ] ; then
  handle-add-path $HOME/bin
fi

PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND ;} history -a"
POWERLEVEL9K_MODE='nerdfont-complete'
ZSH_THEME='powerlevel9k/powerlevel9k'

export POWERLEVEL9K_ALWAYS_SHOW_USER=true
export POWERLEVEL9K_PROMPT_ADD_NEWLINE=true
export POWERLEVEL9K_PROMPT_ON_NEWLINE=true
export POWERLEVEL9K_RPROMPT_ON_NEWLINE=true
export POWERLEVEL9K_MULTILINE_FIRST_PROMPT_PREFIX="↱"
export POWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX="↳ "
export POWERLEVEL9K_INSTALLATION_PATH=$JB_ZSH_BASE/zsh/themes/powerlevel9k
export POWERLEVEL9K_SHORTEN_DIR_LENGTH=2
export POWERLEVEL9K_SHORTEN_STRATEGY="truncate_beginning"

# Status
export POWERLEVEL9K_STATUS_VERBOSE=true
export POWERLEVEL9K_STATUS_CROSS=true

export POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=''
export POWERLEVEL9K_LEFT_SUBSEGMENT_SEPARATOR=' '
export POWERLEVEL9K_WHITESPACE_BETWEEN_LEFT_SEGMENTS=''

# Context
export POWERLEVEL9K_ALWAYS_SHOW_CONTEXT=true
export POWERLEVEL9K_CONTEXT_DEFAULT_FOREGROUND='green'
export POWERLEVEL9K_CONTEXT_TEMPLATE="%F{cyan}%n%f"
export POWERLEVEL9K_CONTEXT_DEFAULT_BACKGROUND='black'

# vcs
export POWERLEVEL9K_SHOW_CHANGESET=true
export POWERLEVEL9K_CHANGESET_HASH_LENGTH=6

export POWERLEVEL9K_VCS_CLEAN_BACKGROUND='none'
export POWERLEVEL9K_VCS_CLEAN_FOREGROUND='076'
export POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND='none'
export POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND='005'
export POWERLEVEL9K_VCS_MODIFIED_BACKGROUND='none'
export POWERLEVEL9K_VCS_MODIFIED_FOREGROUND='003'
export POWERLEVEL9K_VCS_UNTRACKED_ICON='\u25CF'
export POWERLEVEL9K_VCS_UNSTAGED_ICON='\u00b1'
export POWERLEVEL9K_VCS_INCOMING_CHANGES_ICON='\u2193'
export POWERLEVEL9K_VCS_OUTGOING_CHANGES_ICON='\u2191'
export POWERLEVEL9K_VCS_COMMIT_ICON="\uf417"

export POWERLEVEL9K_VCS_GIT_HOOKS=(vcs-detect-changes git-untracked git-aheadbehind git-remotebranch git-tagname)

# time
export POWERLEVEL9K_TIME_FORMAT="%D{\uf017 %H:%M:%S}"
export POWERLEVEL9K_TIME_ICON=''
export POWERLEVEL9K_TIME_BACKGROUND='none'
export POWERLEVEL9K_TIME_FOREGROUND='006'

# ram
export POWERLEVEL9K_RAM_ICON=''
export POWERLEVEL9K_RAM_BACKGROUND='none'
export POWERLEVEL9K_RAM_FOREGROUND='006'

# dir
export POWERLEVEL9K_SHORTEN_DELIMITER=''
export POWERLEVEL9K_SHORTEN_DIR_LENGTH=7
# export POWERLEVEL9K_SHORTEN_STRATEGY='truncate_to_first_and_last'

export POWERLEVEL9K_ETC_ICON=''
export POWERLEVEL9K_FOLDER_ICON=''
export POWERLEVEL9K_HOME_ICON=''
export POWERLEVEL9K_HOME_SUB_ICON=''

export POWERLEVEL9K_DIR_ETC_BACKGROUND='none'
export POWERLEVEL9K_DIR_ETC_FOREGROUND='005'
export POWERLEVEL9K_DIR_HOME_BACKGROUND='none'
export POWERLEVEL9K_DIR_HOME_FOREGROUND='004'
export POWERLEVEL9K_DIR_DEFAULT_BACKGROUND='none'
export POWERLEVEL9K_DIR_DEFAULT_FOREGROUND='005'
export POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND='none'
export POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND='004'

export POWERLEVEL9K_NODE_VERSION_ICON='⬢'
export POWERLEVEL9K_NODE_VERSION_BACKGROUND='none'
export POWERLEVEL9K_NODE_VERSION_FOREGROUND='green'


export POWERLEVEL9K_RIGHT_SEGMENT_SEPARATOR=''
export POWERLEVEL9K_RIGHT_SUBSEGMENT_SEPARATOR=' '
export POWERLEVEL9K_WHITESPACE_BETWEEN_RIGHT_SEGMENTS=''

export POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(root_indicator context dir_writable dir vcs node_version virtualenv)
export POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status background_jobs command_execution_time time battery)

ZSH_PLUGINS_ALIAS_TIPS_TEXT="Alias tip: "

source $HOME/.local/share/fonts/*.sh
source $POWERLEVEL9K_INSTALLATION_PATH/powerlevel9k.zsh-theme
source $USER_LOCAL_SHARE/zsh-history-substring-search/zsh-history-substring-search.zsh

source $JB_ZSH_BASE/zsh/.zsh_aliases
source $JB_ZSH_BASE/zsh/.zsh_functions

plugins=(
  git
  zsh-syntax-highlighting
  zsh-autosuggestions
)

source $ZSH/oh-my-zsh.sh

typeset -gA ZSH_HIGHLIGHT_STYLES

# Syntax Highlighting over-rides
# Theme configuration

export ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets pattern url)
export ZSH_HIGHLIGHT_URL_HIGHLIGHTER_TIMEOUT=4
export ZSH_HIGHLIGHT_STYLES[url-good]='fg=blue,bold'
export ZSH_HIGHLIGHT_STYLES[url-bad]='fg=magenta,bold'
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=green,bold'

# export ZSH_HIGHLIGHT_STYLES[globbing]='fg=yellow'
# export ZSH_HIGHLIGHT_STYLES[command]='fg=white,bold,bg=green'
# export ZSH_HIGHLIGHT_STYLES[builtin]='fg=white,bold,bg=green'
# export ZSH_HIGHLIGHT_STYLES[alias]='fg=white,bold,bg=green'
# export ZSH_HIGHLIGHT_STYLES[path]='bold'
# export ZSH_HIGHLIGHT_PATTERNS+=('rm -rf *' 'fg=white,bold,bg=red')
# export ZSH_HIGHLIGHT_PATTERNS+=('rm -fr *' 'fg=white,bold,bg=red')
# export ZSH_HIGHLIGHT_PATTERNS+=('rm -f *' 'fg=white,bold,bg=red')


# place this after nvm initialization!
autoload -U add-zsh-hook

add-zsh-hook chpwd load-user-specifics
add-zsh-hook chpwd load-nvmrc

load-user-specifics
load-nvmrc

# - Prezto theme
autoload -Uz promptinit
promptinit